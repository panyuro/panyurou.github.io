---
title: 线程池
date: 2024-05-22 23:02:04
tags:
categories:
---

# 1. 线程池的定义

  线程池的基本思想还是一种对象池的思想，开辟一块内存空间，里面存放了众多（未死亡）的线程，池中线程执行调度由池管理器来处理。当有线程任务时，从池中取一个，执行完成后线程对象归池，这样可以避免反复创建线程对象所带来的性能开销，节省了系统的资源，提高了代码执行效率。
  线程池和工厂模式、观察者模式有关（自己不要提，设计模式是个坑）

# 2. 使用线程池的好处

1.降低资源消耗。通过重复利用已创建的线程，从而降低创建和销毁的消耗。
2.提高响应速度。当任务到达时，不需要等待线程创建，直接可以执行任务。
3.提高线程的可管理性。使用线程池可以实现对线程统一分配、调优和监控。

# 3. 常用的线程池有哪些

- newCachedThreadPool：创建一个可缓存的线程池，该线程池不会对线程池大小做限制，它的大小取决于操作系统（或JVM）能够创建的最大线程的大小。
- newFixedThreadPool：创建一个大小固定的线程池，每提交一个任务，就创建一个线程，直到达到线程池的最大线程大小。
- newScheduledThreadPool：创建一个支持定时和周期性执行任务的线程池。
- newSingleThreadExecutor：创建一个单线程的线程池，此线程池保证所有任务的执行顺序按照任务的提交顺序执行。

# 4. 线程池的启动策略

当调用execute（）去添加一个任务时，线程会做以下判断： 

1. 如果正在运行的线程数小于corePoolSize（核心线程数），那么马上会创建线程执行这个任务
2. 如果正在运行的线程数大于或等于corePoolSize，那么会将这个这个任务放入队列。
3. 如果此时队列满了，而且正在运行的线程数小于maximumPoolSize,那么还是要创建线程执行这个任务
4. 如果此时队列满了，而且正在运行的线程数大于或等于maximumPoolSize,那么线程池会抛出异常，告诉调用者无法再接受任务了。

**注意：**

- 在这个过程中，当一个线程完成任务，它会从队列里取出下一个任务来执行
- 当一个线程无事可做，超过一定的时间（KeepAliveTime：线程被回收前的空闲时间）时，线程池会判断；如果当前运行的线程数大于corePoolSize，那么这个线程就会被停掉。
- 当线程池所有任务完成后，他最终会收缩到corePoolSize的大小。
