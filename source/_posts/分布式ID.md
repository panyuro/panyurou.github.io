---
title: 分布式ID
date: 2023-03-17 10:11:18
tags:
categories: 分布式
---

# 1 分布式ID

一个好的分布式ID，一般要满足下列特性：

- **唯一性**：保证全局唯一
- **高可用**，可以由主从、集群等模式保证可用性
- **高性能**，比如基于内存
- **递增性**：适合作为数据库索引
- **安全性**：id如果是顺序递增，则容易暴露业务信息

# 2 全局唯一ID生成策略

### 1. 数据库自增ID

利用数据库的自增主键特性，每次插入记录时，数据库会自动生成一个唯一的ID。

**优点**：

- 简单易用，直接使用数据库提供的功能。
- 保证唯一性。

**缺点**：

- 存在单点故障，数据库成为瓶颈。
- 难以水平扩展，性能可能不足。

### 2. UUID（Universally Unique Identifier）

UUID 是一种标准的唯一标识符，通常为128位长，可以保证全局唯一性。

**优点**：

- 生成简单，不依赖中心化服务。
- 唯一性强。

**缺点**：

- 较长，占用空间大，不适合作为数据库索引。
- 无序，不利于数据库性能优化。

### 3. Twitter的Snowflake算法

Snowflake 是 Twitter 开源的分布式ID生成算法，通过组合时间戳、机器ID和序列号生成ID。

**ID结构**：

- 1位符号位：始终为0。
- 41位时间戳：毫秒级时间戳，可使用69年。
- 10位机器ID：支持1024台机器。
- 12位序列号：每毫秒支持生成4096个ID。

**优点**：

- 高性能，低延迟。
- 时间有序生成，适合数据库索引。

**缺点**：

- 依赖机器时间，时钟回拨可能导致ID重复或冲突。

### 4. 使用Redis生成ID

利用Redis的原子性递增操作，生成分布式唯一ID。

**优点**：

- 简单，利用Redis的原子操作保证唯一性。
- 性能高，Redis操作速度快。

**缺点**：

- 依赖Redis服务，可能成为瓶颈。
- 需要处理Redis的持久化和高可用性。



